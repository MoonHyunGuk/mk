<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">
<sqlMap namespace="collection.collection">	<!-- 수금 내역 -->	<select id="collectionList" resultClass="java.util.HashMap">		SELECT 			READNO,			NEWSCD,			YYMM,			SEQ,			BOSEQ,			SGBBCD,			(SELECT CNAME FROM TC_COMMON WHERE USEYN = 'Y' AND CDCLSF = '119' AND CODE = SGBBCD) SGBBNM,			SGGBCD,			DECODE(BILLAMT, '' , 0 , BILLAMT ) BILLAMT,			BILLQTY,			DECODE(SGYYMM, '', ' ', SGYYMM ) SGYYMM,			DECODE(AMT, '', 0, AMT ) AMT,            DECODE(LOSSAMT, '' , 0 , LOSSAMT ) LOSSAMT,            DECODE(FEE1, '', 0, FEE1) FEE1,            DECODE(FEE2, '', 0, FEE2) FEE2,            DECODE(FEE3, '', 0, FEE3) FEE3,            DECODE(SNDT, '', ' ', SNDT) SNDT,            DECODE(ICDT, '', ' ', ICDT) ICDT,            DECODE(CLDT, '', ' ', CLDT) CLDT,            DECODE(WRKNO, '', ' ', WRKNO) WRKNO,            DECODE(EDIPROCNO, '', ' ', EDIPROCNO) EDIPROCNO,            DECODE(AUTOPROCNO, '', ' ', AUTOPROCNO) AUTOPROCNO,            DECODE(BILLTYPECD, '', ' ', BILLTYPECD) BILLTYPECD,            DECODE(REMK, '', ' ', REMK) REMK,            DECODE(INDT, '', ' ', INDT) INDT,            NVL(INPS, ' ') INPS	FROM 		TM_READER_SUGM	WHERE 		BOSEQ = #boSeq#		AND READNO = #readNo#		AND NEWSCD = #newsCd#		AND SEQ = #seq#		<isNotEmpty property="startYYMM">			<isNotEmpty property="endYYMM">				AND YYMM BETWEEN #startYYMM# AND #endYYMM#			</isNotEmpty>		</isNotEmpty>	ORDER BY YYMM ASC	</select>		<!-- 전년 , 올해 수금 내역 약어 -->	<select id="sumgClam" resultClass="String">	SELECT       UPPER(FUNC_GET_CLAMLIST2(#readNo#, #newsCd#, #seq#, #year#)) AS sugmTxt 	FROM DUAL	</select> 		<!-- 수금 내역 약어 -->	<select id="sumgClamList" resultClass="string">		SELECT FUNC_GET_CLAMLIST(#readNo#, #newsCd#, #seq#, TO_CHAR(SYSDATE, 'YYYY')) CLAMLIST  FROM DUAL	</select>		<!-- 지국ID 중복여부 조회 -->	<select id="getDupAgency" resultClass="java.util.HashMap">		SELECT USERID 		 FROM TM_AGENCY		WHERE USERID = #userId#    </select>        <!-- 지국ID 중복여부 조회 -->	<select id="selectAgencyOverlap" resultClass="string">	   SELECT CASE WHEN T.chkCnt > 0 THEN 'Y'	            ELSE 'N' END AS OVERLAPYN	    FROM (				SELECT COUNT(*) AS chkCnt 				 FROM TM_AGENCY				WHERE USERID = #userId#			 ) T    </select>		<!-- 수금정보 히스토리 업데이트 -->	<insert id="insertReaderSugmHist">	INSERT INTO TH_READER_SUGM		(READNO, NEWSCD, YYMM, SEQ, CHGSEQ, BOSEQ, SGBBCD, SGGBCD, BILLAMT, BILLQTY, SGYYMM, AMT, LOSSAMT, FEE1, FEE2, FEE3, SNDT, ICDT, CLDT,		WRKNO, EDIPROCNO, AUTOPROCNO, BILLTYPECD, REMK, INDT, INPS, CHGDT, CHGPS, HINDT, HINPS ) 	SELECT 		READNO, NEWSCD, YYMM, SEQ, (SELECT LPAD(NVL(MAX(TO_NUMBER(CHGSEQ)),0)+1,3,0) FROM TH_READER_SUGM WHERE READNO=#readNo# AND NEWSCD=#newsCd# 		AND YYMM=#yymm# AND SEQ=#seq# ), BOSEQ, SGBBCD, SGGBCD, BILLAMT, BILLQTY, SGYYMM, AMT, LOSSAMT, FEE1, FEE2, FEE3, SNDT, ICDT, CLDT, WRKNO,		EDIPROCNO, AUTOPROCNO, BILLTYPECD, REMK, INDT, INPS, SYSDATE, #agency_serial#, SYSDATE, #agency_serial# 	FROM 		TM_READER_SUGM 	WHERE 		READNO = #readNo# 		AND NEWSCD = #newsCd#		AND YYMM = #yymm# 		AND SEQ = #seq#		AND BOSEQ = #agency_serial#    </insert>        <!-- 수금정보 히스토리 업데이트 -->	<insert id="insertReaderSugmHistForStopCard">	INSERT INTO TH_READER_SUGM		(READNO, NEWSCD, YYMM, SEQ, CHGSEQ, BOSEQ, SGBBCD, SGGBCD, BILLAMT, BILLQTY, SGYYMM, AMT, LOSSAMT, FEE1, FEE2, FEE3, SNDT, ICDT, CLDT,		WRKNO, EDIPROCNO, AUTOPROCNO, BILLTYPECD, REMK, INDT, INPS, CHGDT, CHGPS, HINDT, HINPS ) 	SELECT 		READNO, NEWSCD, YYMM, SEQ, (SELECT LPAD(NVL(MAX(TO_NUMBER(CHGSEQ)),0)+1,3,0) FROM TH_READER_SUGM WHERE READNO=#readNo# AND NEWSCD='100' 		AND BOSEQ = #boseq# ), BOSEQ, SGBBCD, SGGBCD, BILLAMT, BILLQTY, SGYYMM, AMT, LOSSAMT, FEE1, FEE2, FEE3, SNDT, ICDT, CLDT, WRKNO,		EDIPROCNO, AUTOPROCNO, BILLTYPECD, REMK, INDT, INPS, CHGDT, CHGPS, SYSDATE, #loginId# 	  FROM  TM_READER_SUGM  	 WHERE READNO = #readNo# 		AND NEWSCD = '100'				AND BOSEQ = #boseq#		AND (SGBBCD='044' AND SGGBCD='022')    </insert>    <!-- 수금정보 생성 -->	<insert id="insertReaderSugm">    INSERT INTO TM_READER_SUGM		(READNO, NEWSCD, YYMM, SEQ, BOSEQ, SGBBCD, SGGBCD, BILLAMT, BILLQTY,  SGYYMM, AMT, LOSSAMT, FEE1, FEE2, FEE3, SNDT, ICDT, CLDT, INDT, INPS, CHGDT, CHGPS )	VALUES	( #readNo#, #newsCd#, #yymm#, #seq#, #agency_serial#, #sgbbCd#, #sgType#, (CASE WHEN #billAmt# IS NOT NULL THEN #billAmt# ELSE '0' END), #qty#,	<isNotEmpty property="snDt">		(SELECT SGYYMM		   FROM (SELECT SGYYMM			   	   FROM TM_MONTHCLOSE_HIST			      ORDER BY SGYYMM DESC)	   	  WHERE ROWNUM = 1),	</isNotEmpty>	<isEmpty property="snDt">	'',	</isEmpty>	#amt#, 	<isEmpty property="lossAmt">'' ,</isEmpty>	<isNotEmpty property="lossAmt">#lossAmt# ,</isNotEmpty> 	0, 0, 0, #snDt#, #snDt#,	<isNotEmpty property="snDt">	to_char(sysdate,'yyyymmdd'),	</isNotEmpty> 	<isEmpty property="snDt">	'',	</isEmpty>	sysdate, #agency_serial#, sysdate, #agency_serial#)	</insert>        <!-- 수금정보 생성(ABC) -->	<insert id="insertReaderSugm2">    INSERT INTO TM_READER_SUGM		(READNO, NEWSCD, YYMM, SEQ, BOSEQ, SGBBCD, SGGBCD, BILLAMT, BILLQTY,  SGYYMM, AMT, LOSSAMT, FEE1, FEE2, FEE3, SNDT, ICDT, CLDT, INDT, INPS, CHGDT, CHGPS )	VALUES	( #readNo#, #newsCd#, #yymm#, #seq#, #agency_serial#, #sgbbCd#, #sgType#, (CASE WHEN #billAmt# IS NOT NULL THEN #billAmt# ELSE '0' END), #qty#,	<isNotEmpty property="snDt">		(SELECT CASE WHEN SUBSTR(#snDt#, 7, 2) &lt; 21                  	 THEN TO_CHAR(ADD_MONTHS(TO_DATE(#snDt#, 'YYYYMMDD'), -1), 'YYYYMM')	 	      		 ELSE SUBSTR(#snDt#, 1, 6)         	  	END         FROM DUAL),	</isNotEmpty>	<isEmpty property="snDt">	'',	</isEmpty>	#amt#, 	<isEmpty property="lossAmt">'' ,</isEmpty>	<isNotEmpty property="lossAmt">#lossAmt# ,</isNotEmpty> 	0, 0, 0, #snDt#, #snDt#,	<isNotEmpty property="snDt">	#snDt#,	TO_DATE(#snDt#, 'YYYYMMDD'),	#agency_serial#,	TO_DATE(#snDt#, 'YYYYMMDD'),	#agency_serial#)	</isNotEmpty> 	<isEmpty property="snDt">	'',	sysdate, #agency_serial#, sysdate, #agency_serial#)	</isEmpty>	</insert>	<!-- 수금정보 수정 -->	<update id="updateReaderSugm">    UPDATE  		TM_READER_SUGM  	SET		SGBBCD = #sgbbCd# ,		BILLAMT = (CASE WHEN #billAmt# IS NOT NULL THEN #billAmt# ELSE '0' END) ,		BILLQTY = #qty# ,		<isNotEmpty property="snDt">			SGYYMM = (SELECT SGYYMM						FROM (SELECT SGYYMM								FROM TM_MONTHCLOSE_HIST							   ORDER BY SGYYMM DESC)					   WHERE ROWNUM = 1),		</isNotEmpty>		<isEmpty property="snDt">			SGYYMM = '',		</isEmpty>		AMT = #amt# ,		<isEmpty property="lossAmt">		LOSSAMT =  '' ,		</isEmpty>		<isNotEmpty property="lossAmt">		LOSSAMT =  #lossAmt# ,		</isNotEmpty>		SNDT = #snDt# ,		ICDT = #snDt# ,		<isNotEmpty property="snDt">		CLDT = to_char(sysdate,'yyyymmdd') ,		</isNotEmpty> 		<isEmpty property="snDt">		CLDT = '',		</isEmpty>		CHGDT = sysdate ,		CHGPS = #agency_serial#	where		READNO = #readNo# AND NEWSCD = #newsCd# AND YYMM = #yymm# AND SEQ = #seq# AND BOSEQ = #agency_serial#	</update>	<!-- 수금정보 수정(ABC) -->	<update id="updateReaderSugm2">    UPDATE  		TM_READER_SUGM  	SET		SGBBCD = #sgbbCd# ,		BILLAMT = (CASE WHEN #billAmt# IS NOT NULL THEN #billAmt# ELSE '0' END) ,		BILLQTY = #qty# ,		<isNotEmpty property="snDt">		SGYYMM = (SELECT CASE WHEN SUBSTR(#snDt#, 7, 2) &lt; 21              	      	   	  THEN TO_CHAR(ADD_MONTHS(TO_DATE(#snDt#, 'YYYYMMDD'), -1), 'YYYYMM')	 	     		  		  ELSE SUBSTR(#snDt#, 1, 6)         		  		  END         		     FROM DUAL) ,		</isNotEmpty>		<isEmpty property="snDt">			SGYYMM = '',		</isEmpty>		AMT = #amt# ,		<isEmpty property="lossAmt">		LOSSAMT =  '' ,		</isEmpty>		<isNotEmpty property="lossAmt">		LOSSAMT =  #lossAmt# ,		</isNotEmpty>		SNDT = #snDt# ,		ICDT = #snDt# ,		<isNotEmpty property="snDt">		CLDT = #snDt# ,		</isNotEmpty> 		<isEmpty property="snDt">		CLDT = '',		</isEmpty>		CHGDT = (SELECT TO_DATE(#snDt#, 'YYYYMMDD') FROM DUAL),		CHGPS = #agency_serial#	where		READNO = #readNo# AND NEWSCD = #newsCd# AND YYMM = #yymm# AND SEQ = #seq# AND BOSEQ = #agency_serial#	</update>		<!-- 수금정보 수정 -->	<update id="updateReaderSugmForStopCard">    	UPDATE TM_READER_SUGM  			 SET SGGBCD = '011' 			    , CHGDT = sysdate 			    , CHGPS = #loginId#	     WHERE READNO = #readNo# 		    		    AND NEWSCD = '100'				    AND BOSEQ = #boseq#		    AND (SGBBCD='044' AND SGGBCD='022')	</update></sqlMap>